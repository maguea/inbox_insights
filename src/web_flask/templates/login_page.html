{% extends "base.html" %}

{% block title %}Login{% endblock %}

{% block page_content %}
<div class="page-header mb-4">
    <h1>Login</h1>
</div>
<div class="card">
    <div class="card-body">
        <form id="emailForm">
            <div class="mb-3">
                <label for="user" class="form-label">Email Address</label>
                <input type="email" class="form-control" id="user" name="user"
                    placeholder="{% if user %}{{ user }}{% else %}mail@example.com{% endif %}"
                    value="{% if user %}{{ user }}{% endif %}" required>
                <div class="form-text">Your full email address</div>
            </div>

            <div class="mb-3">
                <label for="key" class="form-label">
                    App Password / Key
                </label>
                <input type="password" class="form-control" id="key" name="key"
                    placeholder="Your email app password or API key" required>
                <div class="form-text">
                    Use your email provider's app password or generated key (not your normal login password).
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">IMAP Server</label>
                <div class="btn-group" role="group" aria-label="IMAP Server selection">
                    {# derive domain from the email string if present #}
                    {% if user %}
                    {% set domain = user.split('@')[-1] %}
                    {% else %}
                    {% set domain = '' %}
                    {% endif %}

                    <input type="radio" class="btn-check" name="server" id="gmail" value="imap.gmail.com" {# default to
                        Gmail if no user yet or if email looks like a Gmail address #} {% if not user or 'gmail.com' in
                        domain %} checked {% endif %}>
                    <label class="btn btn-outline-primary" for="gmail">Gmail</label>

                    <input type="radio" class="btn-check" name="server" id="outlook" value="outlook.office365.com" {#
                        default to Outlook if email domain looks like an Outlook/Microsoft one #} {% if 'outlook.com' in
                        domain or 'hotmail.com' in domain or 'live.com' in domain or 'office365.com' in domain %}
                        checked {% endif %}>
                    <label class="btn btn-outline-primary" for="outlook">Outlook</label>
                </div>
                <div class="form-text mt-2">Select your email provider</div>
            </div>


            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="submit" class="btn btn-primary" id="submitBtn">
                    {% if user %}
                    Update Email
                    {% else %}
                    Save & Connect
                    {% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}